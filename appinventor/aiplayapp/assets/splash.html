<html>
    <head>
        <title>Welcome to MIT App Inventor</title>
        <script type="text/javascript">
         var permissions = ['android.permission.WRITE_EXTERNAL_STORAGE'];
         function permresult(permission, result) {
             start();/* Re-evaluate whether or not to display */
         }
         function hasallpermissions() {
             var haveall = true;
             for (i = 0; i < permissions.length; i++) {
                 haveall = haveall && Android.hasPermission(permissions[i]);
             }
             return haveall;
         }
         function start() {
             var item = document.getElementById("needpermission");
             var cbutton = document.getElementById("cbutton");
             if (!hasallpermissions()) {
                 item.style.display = "block";
                 cbutton.style.display = "none";
             } else {
                 item.style.display = "none";
                 cbutton.style.display = "block";
             }
             getmotd();
         }
         function getpermission() {
             for (i = 0; i < permissions.length; i++) {
                 var perm = permissions[i];
                 if (!Android.hasPermission(perm)) {
                     Android.askPermission(perm);
                     break;
                 }
             }
         }
         function done() {
             Android.finished();
         }
         function getmotd() {
             xhr = new XMLHttpRequest();
             xhr.open("GET", "http://templates.appinventor.mit.edu/mit/m.json");
             xhr.onreadystatechange = function() {
                 if (this.status == 200) {
                     var json = JSON.parse(this.response);
                     var mess = document.getElementById("motd");
                     mess.innerHTML = json['message'];
                 }
             };
             xhr.send();
         }
        </script>

    </head>
    <body onload="start();">
        <center>
            <h1>Welcome to MIT App Inventor!</h1>
        </center>
        <p>Welcome to the MIT App Inventor Companion Application. You use this application in conjunction with
            the MIT App Inventor application authoring system. You can learn more about it at http://appinventor.mit.edu.
        </p>
        <div id="motd">
        </div>
        <div id="needpermission" style="display:none;">
        <p>
            The Companion needs STORAGE permission. Press the "Get Permissions" button below to ask your device
            to grant these permissions.
        </p>
        <p>&nbsp;</p>
        <button onclick="getpermission();">Get Permissions</button>
        </div>
        <p>&nbsp;</p>
        <div id="cbutton">
            <button onclick="done();">Continue</button>
        </div>
    </body>
</html>
